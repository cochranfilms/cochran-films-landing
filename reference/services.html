<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Primary Meta Tags -->
  <title>Cochran Films | Services | Full-Stack Creative Agency & White-Label Services | Atlanta</title>
  <meta name="title" content="Cochran Films | Services | Full-Stack Creative Agency & White-Label Services | Atlanta" />
  <meta name="description" content="From cinematic production to web development, we deliver comprehensive creative solutions that drive results. Professional video production, web development, and white-label services." />
  <meta name="keywords" content="creative agency, video production, web development, white-label services, Atlanta, storytelling, full-stack, branding, content creation, film production" />
  <meta name="author" content="Cody Cochran, CEO & Founder" />
  
  <!-- Fonts + Icons (CDN) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Poppins:wght@500;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  
  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <!-- Airtable CMS Integration -->
  <script>
    window.API_BASE_URL = window.location.origin;
  </script>
  <script src="js/airtable-cms.js"></script>
  
  <!-- User Preferences Management -->
  <script src="js/user-preferences-manager.js"></script>
  
  <!-- Stripe Integration -->
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    // Stripe will be initialized after fetching publishable key from /api/config
    let stripe = null;
    window.stripeCart = { items: [], total: 0 };
    console.log('Stripe cart initialized:', window.stripeCart);
  </script>
  
  <script>
    (function(){
      try {
        if (typeof emailjs !== 'undefined') {
          emailjs.init('p4pF3OWvh-DXtae4c');
          console.log('✅ EmailJS initialized securely');
        } else {
          console.warn('⚠️ EmailJS not loaded - forms will fallback to manual submission');
        }
      } catch (error) {
        console.error('❌ EmailJS initialization failed:', error);
      }
    })();
  </script>
  
  <style>
    :root {
      --brand-indigo: #6366f1;
      --brand-emerald: #10b981;
      --brand-amber: #f59e0b;
      --brand-gold: #FFB200;
      --brand-blue: #0066CC;
      --brand-red: #ef4444;
      --dark-900: #0f172a;
      --dark-950: #020617;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --card-bg: rgba(15, 23, 42, 0.7);
      --card-border: 1px solid rgba(99,102,241,0.20);
      --backdrop: blur(12px);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 10px;
      --shadow-lg: 0 30px 80px rgba(0,0,0,0.45);
      --shadow-md: 0 18px 40px rgba(0,0,0,0.35);
      --shadow-sm: 0 10px 24px rgba(0,0,0,0.25);
      --glow-indigo: 0 0 40px rgba(99,102,241,0.35);
      --glow-gold: 0 0 40px rgba(255,178,0,0.35);
      --transition: all 300ms cubic-bezier(.4,0,.2,1);
      --transition-fast: all 180ms cubic-bezier(.4,0,.2,1);
    }

    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      height: 100%;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(99,102,241,0.08), transparent 60%),
                  radial-gradient(1000px 600px at 100% 20%, rgba(255,178,0,0.06), transparent 60%),
                  linear-gradient(135deg, rgba(15,23,42,0.7) 0%, rgba(2,6,23,0.8) 100%);
      color: var(--text-primary);
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    /* AI Background & Neural Network */
    .ai-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    #neuralCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Navigation Styles */
    .nav-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(99,102,241,0.2);
      transition: var(--transition);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 80px;
      position: relative;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      text-decoration: none;
      position: absolute;
      left: 20px;
    }

    .nav-logo img {
      height: 48px;
      width: auto;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    }

    .nav-menu {
      display: flex;
      align-items: center;
      gap: 8px;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-item {
      position: relative;
    }

    .nav-item.has-submenu .dropdown-caret { font-size: 12px; opacity: 0.7; }
    .submenu {
      position: absolute; top: 100%; left: 0; min-width: 220px; padding: 8px; margin-top: 6px;
      background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(16px);
      border: 1px solid rgba(99,102,241,0.25); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      list-style: none; display: none; z-index: 1200;
    }
    .submenu .submenu-link { display: block; padding: 10px 12px; border-radius: 8px; color: var(--text-secondary); text-decoration: none; font-weight: 600; }
    .submenu .submenu-link:hover { color: var(--text-primary); background: rgba(99,102,241,0.1); }
    .nav-item.has-submenu:hover .submenu { display: block; }
    .nav-item.has-submenu:last-child .submenu { right: 0; left: auto; }

    .nav-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: 999px;
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition-fast);
      border: 1px solid transparent;
    }

    .nav-link:hover {
      color: var(--text-primary);
      background: rgba(99,102,241,0.1);
      border-color: rgba(99,102,241,0.3);
    }

    .nav-link.active {
      color: var(--brand-gold);
      background: rgba(255,178,0,0.1);
      border-color: rgba(255,178,0,0.3);
    }

    .nav-cta {
      background: linear-gradient(135deg, var(--brand-gold), #ffd166);
      color: #0a0a0a;
      border: 0;
      padding: 12px 20px;
      border-radius: 14px;
      font-weight: 800;
      letter-spacing: .02em;
      box-shadow: var(--glow-gold);
      transition: var(--transition-fast);
    }

    .nav-cta:hover {
      transform: translateY(-2px);
      filter: brightness(1.05);
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      position: absolute;
      right: 20px;
    }

    /* Layout wrapper */
    .wrapper {
      position: relative;
      z-index: 2;
      max-width: 1200px;
      margin: 0 auto;
      padding: 100px 20px 60px;
    }

    /* Section Styles */
    .section {
      margin-top: 80px;
      padding: 60px 0;
      scroll-margin-top: 100px;
    }

    .section:first-of-type {
      margin-top: 0;
      padding-top: 0;
    }

    .section-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .section-title {
      font-size: clamp(32px, 6vw, 56px);
      line-height: 1.05;
      font-weight: 900;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, #fff, #dbeafe 40%, #fde68a 85%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 20px;
    }

    .section-subtitle {
      color: var(--text-secondary);
      font-size: clamp(18px, 2.4vw, 22px);
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* Services Grid */
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-top: 60px;
    }

    .service-card {
      background: var(--card-bg);
      border: var(--card-border);
      border-radius: var(--radius-lg);
      padding: 40px 30px;
      text-align: center;
      backdrop-filter: var(--backdrop);
      box-shadow: var(--shadow-md);
      transition: var(--transition);
    }

    .service-card:hover {
      transform: translateY(-8px);
      border-color: rgba(99,102,241,0.4);
      box-shadow: var(--shadow-lg);
    }

    .service-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(99,102,241,0.2), rgba(255,178,0,0.2));
      display: grid;
      place-items: center;
      font-size: 32px;
      color: var(--brand-gold);
    }

    .service-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 16px;
    }

    .service-description {
      color: var(--text-secondary);
      font-size: 16px;
      line-height: 1.6;
      margin: 0;
    }

    /* Footer */
    .footer {
      margin-top: 80px;
      padding: 40px 0;
      text-align: center;
      border-top: 1px solid rgba(99,102,241,0.2);
    }

    .footer-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }

    .footer-logo {
      display: flex;
      align-items: center;
    }

    .footer-logo img {
      height: 40px;
      width: auto;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    .footer-social {
      display: flex;
      gap: 16px;
    }

    .social-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.2);
      color: var(--text-secondary);
      text-decoration: none;
      background: rgba(15,23,42,0.5);
      transition: var(--transition-fast);
    }

    .social-link:hover {
      border-color: rgba(148,163,184,0.4);
      color: var(--text-primary);
      transform: translateY(-2px);
    }

    .footer-copyright {
      color: var(--text-muted);
      font-size: 14px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .nav-container {
        height: 70px;
        padding: 0 16px;
      }

      .nav-menu {
        display: none;
        position: absolute;
        top: 70px;
        left: 0;
        right: 0;
        flex-direction: column;
        gap: 6px;
        background: rgba(15, 23, 42, 0.98);
        border-bottom: 1px solid rgba(99,102,241,0.2);
        padding: 10px 12px 12px;
        z-index: 1001;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .nav-menu.show {
        display: flex;
      }

      .wrapper {
        padding: 90px 16px 40px;
      }

      .section {
        margin-top: 60px;
        padding: 40px 0;
      }

      .services-grid {
        grid-template-columns: 1fr;
        gap: 24px;
      }
    }

    @media (max-width: 480px) {
      .section-title {
        font-size: clamp(28px, 8vw, 40px);
      }

      .service-card {
        padding: 30px 20px;
      }
    }

    /* Service Package Builder Styles */
    .service-package-builder {
      margin-top: 60px;
      padding: 40px;
      background: var(--card-bg);
      border: var(--card-border);
      border-radius: var(--radius-lg);
      backdrop-filter: var(--backdrop);
    }

    /* Stripe Shopping Cart Styles */
    .stripe-cart-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: var(--brand-gold);
      color: #000;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      transition: var(--transition);
    }

    .stripe-cart-toggle:hover {
      transform: scale(1.1);
      box-shadow: var(--glow-gold);
    }

    .stripe-cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--brand-red);
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .stripe-cart {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: var(--dark-900);
      border-left: 1px solid var(--card-border);
      z-index: 1001;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: -5px 0 20px rgba(0, 0, 0, 0.3);
    }

    .stripe-cart.show {
      right: 0;
    }

    .stripe-cart-header {
      padding: 20px;
      border-bottom: 1px solid var(--card-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stripe-cart-header h3 {
      margin: 0;
      color: var(--text-primary);
      font-size: 18px;
      font-weight: 600;
    }

    .stripe-cart-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 20px;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: var(--transition);
    }

    .stripe-cart-close:hover {
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.1);
    }

    .stripe-cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .stripe-cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stripe-cart-item:last-child {
      border-bottom: none;
    }

    .stripe-cart-item-info h4 {
      margin: 0 0 5px 0;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
    }

    .stripe-cart-item-info p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 12px;
    }

    .stripe-cart-item-price {
      color: var(--brand-gold);
      font-weight: 600;
      font-size: 14px;
    }

    .stripe-cart-item-remove {
      background: none;
      border: none;
      color: var(--brand-red);
      cursor: pointer;
      padding: 5px;
      border-radius: 3px;
      transition: var(--transition);
    }

    .stripe-cart-item-remove:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    .stripe-cart-footer {
      padding: 20px;
      border-top: 1px solid var(--card-border);
    }

    .stripe-cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stripe-cart-total-label {
      color: var(--text-secondary);
      font-size: 16px;
    }

    .stripe-cart-total-amount {
      color: var(--brand-gold);
      font-size: 20px;
      font-weight: 700;
    }

    .stripe-cart-actions {
      display: flex;
      gap: 10px;
    }

    .stripe-cart-checkout {
      flex: 2;
      background: var(--brand-gold);
      color: #000;
      border: none;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .stripe-cart-checkout:hover {
      background: #e6a600;
      transform: translateY(-2px);
    }

    .stripe-cart-clear {
      flex: 1;
      background: rgba(239, 68, 68, 0.1);
      color: var(--brand-red);
      border: 1px solid var(--brand-red);
      padding: 12px 20px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .stripe-cart-clear:hover {
      background: var(--brand-red);
      color: white;
    }

    /* Service Detail Modal Styles */
    .service-detail-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1002;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .service-detail-modal.show {
      display: flex;
    }

    .service-detail-content {
      background: var(--dark-900);
      border: var(--card-border);
      border-radius: var(--radius-lg);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .service-detail-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: var(--transition);
      z-index: 1;
    }

    .service-detail-close:hover {
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.1);
    }

    .service-detail-header {
      padding: 40px 40px 20px;
      text-align: center;
      border-bottom: 1px solid var(--card-border);
    }

    .service-detail-icon {
      width: 80px;
      height: 80px;
      background: var(--brand-gold);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 32px;
      color: #000;
    }

    .service-detail-title {
      margin: 0 0 15px 0;
      color: var(--text-primary);
      font-size: 28px;
      font-weight: 700;
    }

    .service-detail-price {
      margin: 0 0 15px 0;
      color: var(--brand-gold);
      font-size: 32px;
      font-weight: 800;
    }

    .service-detail-description {
      margin: 0;
      color: var(--text-secondary);
      font-size: 16px;
      line-height: 1.6;
    }

    .service-detail-body {
      padding: 30px 40px 40px;
    }

    .service-detail-features {
      margin-bottom: 30px;
    }

    .service-detail-features h3 {
      margin: 0 0 20px 0;
      color: var(--text-primary);
      font-size: 20px;
      font-weight: 600;
    }

    .service-detail-features ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .service-detail-features li {
      color: var(--text-secondary);
      margin-bottom: 12px;
      padding-left: 25px;
      position: relative;
      font-size: 15px;
      line-height: 1.5;
    }

    .service-detail-features li:before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--brand-gold);
      font-weight: bold;
    }

    .service-detail-actions {
      display: flex;
      gap: 15px;
    }

    .service-detail-add-cart,
    .service-detail-checkout {
      flex: 1;
      padding: 15px 25px;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .service-detail-add-cart {
      background: rgba(99, 102, 241, 0.1);
      color: var(--brand-indigo);
      border: 1px solid var(--brand-indigo);
    }

    .service-detail-add-cart:hover {
      background: var(--brand-indigo);
      color: white;
    }

    .service-detail-checkout {
      background: var(--brand-gold);
      color: #000;
    }

    .service-detail-checkout:hover {
      background: #e6a600;
      transform: translateY(-2px);
    }

    /* Make service cards clickable */
    .service-card {
      cursor: pointer;
      transition: var(--transition);
    }

    .service-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }
    
    /* Portfolio preview gallery (Airtable-backed) */
    .services-portfolio-section {
      margin-top: 80px;
    }
    .services-portfolio-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 14px;
    }
    .services-portfolio-title {
      margin: 0;
      font-size: 24px;
      font-weight: 800;
      letter-spacing: -0.01em;
    }
    .services-portfolio-subtitle {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.2);
      background: rgba(15,23,42,0.5);
      box-shadow: var(--shadow-sm);
      aspect-ratio: 16 / 9;
      cursor: pointer;
    }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .gallery-overlay {
      position: absolute; inset: 0; display: flex; align-items: flex-end; justify-content: space-between;
      padding: 10px 12px; background: linear-gradient(to top, rgba(2,6,23,0.75), rgba(2,6,23,0)); opacity: 0; transition: var(--transition-fast);
    }
    .gallery-item:hover .gallery-overlay { opacity: 0; }
    .gallery-play-btn { width: 36px; height: 36px; border-radius: 50%; background: var(--brand-gold); color: #000; display: grid; place-items: center; box-shadow: var(--glow-gold); }
    .gallery-info { margin-left: 8px; color: var(--text-secondary); font-size: 12px; }
    .gallery-info h4 { margin: 0; font-size: 13px; color: var(--text-primary); font-weight: 700; }
    
    /* Elevated card presentation */
    .cf-card { border-radius: 16px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid rgba(148,163,184,0.18); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.25); transition: box-shadow .2s ease, border-color .2s ease; }
    .cf-card:hover { transform: none; border-color: rgba(148,163,184,0.22); box-shadow: 0 12px 32px rgba(0,0,0,0.26); }
    .cf-thumb { position: relative; aspect-ratio: 16/9; overflow: hidden; background: rgba(2,6,23,0.6); }
    .cf-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; transform: none; transition: none; }
    .cf-card:hover .cf-thumb img { transform: none; filter: none; }
    .cf-chip { position: absolute; top: 10px; left: 10px; padding: 6px 10px; font-size: 12px; border-radius: 999px; background: rgba(2,6,23,0.7); color: var(--text-secondary); border: 1px solid rgba(148,163,184,0.25); backdrop-filter: blur(6px); }
    .cf-badge { position: absolute; top: 10px; right: 10px; width: 32px; height: 32px; border-radius: 50%; display: grid; place-items: center; background: linear-gradient(135deg, var(--brand-gold), #ffd166); color: #0a0a0a; box-shadow: var(--glow-gold); }
    .cf-action { position: absolute; right: 12px; bottom: 12px; width: 40px; height: 40px; border-radius: 12px; display: grid; place-items: center; background: rgba(255,178,0,0.9); color: #0a0a0a; opacity: 0.85; transform: none; transition: none; box-shadow: var(--glow-gold); }
    .cf-card:hover .cf-action { opacity: 0.85; transform: none; }
    .cf-body { padding: 12px 14px 14px; }
    .cf-title { margin: 0 0 6px; font-size: 15px; line-height: 1.35; font-weight: 800; color: var(--text-primary); letter-spacing: -0.01em; }
    .cf-sub { margin: 0 0 10px; color: var(--text-secondary); font-size: 12px; }
    .cf-meta { display: flex; align-items: center; justify-content: space-between; gap: 8px; font-size: 11px; color: var(--text-muted); }
    .cf-pill { padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(148,163,184,0.25); background: rgba(15,23,42,0.5); color: var(--text-secondary); max-width: 70%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .cf-date { color: var(--text-muted); }
    
    /* Skeletons */
    .cf-skel { border-radius: 16px; overflow: hidden; border: 1px solid rgba(148,163,184,0.15); background: rgba(2,6,23,0.5); }
    .cf-skel-top { aspect-ratio: 16/9; background: linear-gradient(90deg, rgba(30,41,59,0.6) 25%, rgba(51,65,85,0.6) 50%, rgba(30,41,59,0.6) 75%); background-size: 400% 100%; animation: shimmer 1.6s infinite; }
    .cf-skel-body { padding: 12px 14px 16px; }
    .cf-skel-line { height: 10px; border-radius: 6px; background: linear-gradient(90deg, rgba(30,41,59,0.6) 25%, rgba(51,65,85,0.6) 50%, rgba(30,41,59,0.6) 75%); background-size: 400% 100%; animation: shimmer 1.6s infinite; margin-bottom: 8px; }
    .cf-skel-line.lg { height: 14px; border-radius: 8px; }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    
    @media (max-width: 768px) {
      .gallery-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 500px) {
      .gallery-grid { grid-template-columns: 1fr; }
    }
    
    /* Masonry layout for Photography */
    .masonry-grid { column-count: 4; column-gap: 14px; }
    .masonry-item { break-inside: avoid; margin-bottom: 14px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(148,163,184,0.2); background: rgba(15,23,42,0.5); }
    .masonry-item img { width: 100%; height: auto; display: block; object-fit: contain; background: rgba(2,6,23,0.6); }
    @media (max-width: 1200px) { .masonry-grid { column-count: 3; } }
    @media (max-width: 900px) { .masonry-grid { column-count: 2; } }
    @media (max-width: 520px) { .masonry-grid { column-count: 1; } }
  </style>
</head>
<body>
  <!-- AI Neural Network Background -->
  <div class="ai-background">
    <canvas id="neuralCanvas"></canvas>
  </div>

  <!-- Navigation -->
  <nav class="nav-wrapper" role="navigation" aria-label="Main navigation">
    <div class="nav-container">
      <a href="/home.html" class="nav-logo">
        <img src="CF_Logo_White2025.png" alt="Cochran Films logo" />
      </a>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="/home.html" class="nav-link">Home</a>
        </li>
        <li class="nav-item">
          <a href="/about.html" class="nav-link">About</a>
        </li>
        <li class="nav-item">
          <a href="/services.html" class="nav-link active">Services</a>
        </li>
        <li class="nav-item has-submenu">
          <a href="/portfolio.html" class="nav-link">Portfolio <i class="fas fa-chevron-down dropdown-caret" aria-hidden="true"></i></a>
          <ul class="submenu" aria-label="Portfolio Categories">
            <li><a href="/portfolio.html#video-production" class="submenu-link">Video Production</a></li>
            <li><a href="/portfolio.html#web-development" class="submenu-link">Web Development</a></li>
            <li><a href="/portfolio.html#photography" class="submenu-link">Photography</a></li>
            <li><a href="/portfolio.html#brand-development" class="submenu-link">Brand Development</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a href="/blog.html" class="nav-link">Blog</a>
        </li>
        <li class="nav-item">
          <a href="/contact.html" class="nav-link">Contact</a>
        </li>
        <li class="nav-item">
          <a href="/book.html" class="nav-link nav-cta">Book Services</a>
        </li>
      </ul>

      <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>

  <div class="wrapper">
    <!-- Services Section -->
    <section id="services" class="section">
      <div class="section-header">
        <h2 class="section-title">Our Services</h2>
        <p class="section-subtitle">
          From cinematic production to web development, we deliver comprehensive creative solutions that drive results.
        </p>
      </div>

      <!-- Temporary Debug Button -->
      <div style="text-align: center; margin-bottom: 30px;">
        <button onclick="testCart()" style="
          background: var(--brand-gold);
          color: #000;
          border: none;
          padding: 10px 20px;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
        ">
          Test Cart (Debug)
        </button>
      </div>

      <div class="services-grid">
        <div class="service-card">
          <div class="service-icon">
            <i class="fas fa-video"></i>
          </div>
          <h3 class="service-title">Video Production</h3>
          <p class="service-description">
            Professional video production including commercials, brand films, documentaries, and live event coverage. From corporate storytelling to live events, we deliver high-level production value and strategic impact.
          </p>
        </div>

        <div class="service-card">
          <div class="service-icon">
            <i class="fas fa-camera"></i>
          </div>
          <h3 class="service-title">Photography</h3>
          <p class="service-description">
            Live event printing, portraits, product photography, and event coverage with instant printing capabilities. With 4x6 and 5x7 options, branded templates, and seamless approval processes.
          </p>
        </div>

        <div class="service-card">
          <div class="service-icon">
            <i class="fas fa-code"></i>
          </div>
          <h3 class="service-title">Web Development</h3>
          <p class="service-description">
            Custom website development and maintenance, from strategy and design to publishing and ongoing support. We handle everything from strategy and design to publishing and upkeep.
          </p>
        </div>

        <div class="service-card">
          <div class="service-icon">
            <i class="fas fa-palette"></i>
          </div>
          <h3 class="service-title">Brand Development</h3>
          <p class="service-description">
            Complete brand identity development including logos, design systems, and strategic brand positioning. Our newest service combines design, web, and systems setup — done for you.
          </p>
        </div>
        
        <div class="service-card">
          <div class="service-icon">
            <i class="fas fa-users-gear"></i>
          </div>
          <h3 class="service-title">White-Label Services</h3>
          <p class="service-description">
            Enterprise-ready sites and systems you can deploy under your brand. Built for fast, brand-safe deployment with modern CI/CD and versioned infrastructure.
          </p>
        </div>
        
        <div class="service-card">
          <div class="service-icon">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <h3 class="service-title">Workshops & Training</h3>
          <p class="service-description">
            Build Your Website in Just 2 DAYS — With Expert Support Every Step of the Way. Join our in-person Website Workshop in Atlanta.
          </p>
        </div>
      </div>
    </section>
    
    <!-- Airtable-powered portfolio previews -->
    <section id="portfolio-previews" class="section services-portfolio-section">
      <div class="section-header" style="margin-bottom: 30px;">
        <h2 class="section-title">Recent Work</h2>
        <p class="section-subtitle">Live previews populated from our Airtable portfolio.</p>
      </div>
      
      <div class="services-portfolio-group" style="display:grid; gap:26px;">
        <div>
          <div class="services-portfolio-header">
            <h3 class="services-portfolio-title"><i class="fas fa-video" style="color: var(--brand-gold);"></i> Video Production</h3>
            <p class="services-portfolio-subtitle">Rotates daily</p>
          </div>
          <div class="gallery-grid" id="videoProductionGridServices"></div>
        </div>
        <div>
          <div class="services-portfolio-header">
            <h3 class="services-portfolio-title"><i class="fas fa-code" style="color: var(--brand-gold);"></i> Web Development</h3>
            <p class="services-portfolio-subtitle">Live links where available</p>
          </div>
          <div class="gallery-grid" id="webDevelopmentGridServices"></div>
        </div>
        <div>
          <div class="services-portfolio-header">
            <h3 class="services-portfolio-title"><i class="fas fa-camera" style="color: var(--brand-gold);"></i> Photography</h3>
            <p class="services-portfolio-subtitle">Tap to view</p>
          </div>
          <div class="masonry-grid" id="photographyGridServices"></div>
        </div>
        <div>
          <div class="services-portfolio-header">
            <h3 class="services-portfolio-title"><i class="fas fa-palette" style="color: var(--brand-gold);"></i> Brand Development</h3>
            <p class="services-portfolio-subtitle">Identity systems and assets</p>
          </div>
          <div class="gallery-grid" id="brandDevelopmentGridServices"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- Stripe Shopping Cart -->
  <button class="stripe-cart-toggle" id="stripeCartToggle">
    <i class="fas fa-shopping-cart"></i>
    <span class="stripe-cart-count" id="stripeCartCount">0</span>
  </button>
  
  <div class="stripe-cart" id="stripeCart">
    <div class="stripe-cart-header">
      <h3>Shopping Cart</h3>
      <button class="stripe-cart-close" id="stripeCartClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="stripe-cart-items" id="stripeCartItems">
      <!-- Cart items will be populated here -->
    </div>
    
    <div class="stripe-cart-footer">
      <div class="stripe-cart-total">
        <span class="stripe-cart-total-label">Total:</span>
        <span class="stripe-cart-total-amount" id="stripeCartTotal">$0.00</span>
      </div>
      
      <div class="stripe-cart-actions">
        <button class="stripe-cart-checkout" id="stripeCartCheckout">
          <i class="fas fa-credit-card"></i>
          Checkout
        </button>
        <button class="stripe-cart-clear" id="stripeCartInvoice">
          <i class="fas fa-file-invoice"></i>
          Invoice
        </button>
        <button class="stripe-cart-clear" id="stripeCartClear">
          <i class="fas fa-trash"></i>
          Clear
        </button>
      </div>
    </div>
  </div>
  
  <!-- Service Detail Modal -->
  <div class="service-detail-modal" id="serviceDetailModal">
    <div class="service-detail-content">
      <button class="service-detail-close" id="serviceDetailClose">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="service-detail-header">
        <div class="service-detail-icon" id="serviceDetailIcon">
          <i class="fas fa-cog"></i>
        </div>
        <h2 class="service-detail-title" id="serviceDetailTitle">Service Title</h2>
        <p class="service-detail-price" id="serviceDetailPrice">$0</p>
        <p class="service-detail-description" id="serviceDetailDescription">Service description</p>
      </div>
      
      <div class="service-detail-body">
        <div class="service-detail-features">
          <h3>What's Included</h3>
          <ul id="serviceDetailFeatures">
            <!-- Features will be populated here -->
          </ul>
        </div>
        
        <div class="service-detail-actions">
          <button class="service-detail-add-cart" id="serviceDetailAddCart">
            <i class="fas fa-cart-plus"></i>
            Add to Cart
          </button>
          <button class="service-detail-checkout" id="serviceDetailCheckout">
            <i class="fas fa-credit-card"></i>
            Checkout Now
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="CF_Logo_White2025.png" alt="Cochran Films logo" />
      </div>

      <div class="footer-social">
        <a href="mailto:info@cochranfilms.com" class="social-link">
          <i class="fas fa-envelope"></i>
          Email
        </a>
        <a href="https://www.instagram.com/cochran.films" target="_blank" rel="noopener" class="social-link">
          <i class="fab fa-instagram"></i>
          Instagram
        </a>
        <a href="https://www.youtube.com/@cochranfilmsllc" target="_blank" rel="noopener" class="social-link">
          <i class="fas fa-youtube"></i>
          YouTube
        </a>
        <a href="https://github.com/cochranfilms" target="_blank" rel="noopener" class="social-link">
          <i class="fab fa-github"></i>
          GitHub
        </a>
      </div>

      <div class="footer-copyright">
        © 2025 Cochran Films LLC. All rights reserved.
      </div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    const mobileToggle = document.querySelector('.mobile-menu-toggle');
    const navMenu = document.querySelector('.nav-menu');

    mobileToggle.addEventListener('click', () => {
      navMenu.classList.toggle('show');
    });

    // Navigation scroll effect
    window.addEventListener('scroll', () => {
      const nav = document.querySelector('.nav-wrapper');
      if (window.scrollY > 100) {
        nav.style.background = 'rgba(15, 23, 42, 0.98)';
      } else {
        nav.style.background = 'rgba(15, 23, 42, 0.95)';
      }
    });

    // ========================================
    // AI NEURAL NETWORK BACKGROUND
    // ========================================
    class AINeuralNetwork {
      constructor() {
        this.canvas = document.getElementById('neuralCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.particles = [];
        this.connections = [];
        this.mouse = { x: 0, y: 0 };
        this.animationId = null;
        
        this.init();
      }
      
      init() {
        this.resize();
        this.createParticles();
        this.createConnections();
        this.bindEvents();
        this.animate();
      }
      
      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }
      
      createParticles() {
        this.particles = [];
        const particleCount = 100;
        for (let i = 0; i < particleCount; i++) {
          this.particles.push({
            x: Math.random() * this.canvas.width,
            y: Math.random() * this.canvas.height,
            vx: (Math.random() - 0.5) * 0.3,
            vy: (Math.random() - 0.5) * 0.3,
            size: Math.random() * 2 + 1,
            color: this.getRandomAIColor(),
            pulse: Math.random() * Math.PI * 2
          });
        }
      }
      
      createConnections() {
        this.connections = [];
        const connectionDistance = 120;
        for (let i = 0; i < this.particles.length; i++) {
          for (let j = i + 1; j < this.particles.length; j++) {
            const distance = this.getDistance(this.particles[i], this.particles[j]);
            if (distance < connectionDistance) {
              this.connections.push({
                from: i,
                to: j,
                strength: 1 - (distance / connectionDistance),
                pulse: Math.random() * Math.PI * 2
              });
            }
          }
        }
      }
      
      getRandomAIColor() {
        const colors = [
          'rgba(6, 182, 212, 0.6)',    // AI Cyan
          'rgba(20, 184, 166, 0.6)',   // AI Teal
          'rgba(124, 58, 237, 0.6)',   // AI Violet
          'rgba(99, 102, 241, 0.6)',   // Brand Indigo
          'rgba(255, 178, 0, 0.6)'     // Brand Gold
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      }
      
      getDistance(p1, p2) {
        const dx = p1.x - p2.x;
        const dy = p1.y - p2.y;
        return Math.sqrt(dx * dx + dy * dy);
      }
      
      bindEvents() {
        window.addEventListener('resize', () => this.resize());
        
        document.addEventListener('mousemove', (e) => {
          this.mouse.x = e.clientX;
          this.mouse.y = e.clientY;
        });
      }
      
      updateParticles() {
        this.particles.forEach(particle => {
          // Update position
          particle.x += particle.vx;
          particle.y += particle.vy;
          
          // Bounce off edges
          if (particle.x <= 0 || particle.x >= this.canvas.width) {
            particle.vx *= -1;
          }
          if (particle.y <= 0 || particle.y >= this.canvas.height) {
            particle.vy *= -1;
          }
          
          // Update pulse
          particle.pulse += 0.02;
          
          // Mouse interaction
          const mouseDistance = this.getDistance(particle, this.mouse);
          if (mouseDistance < 150) {
            const angle = Math.atan2(this.mouse.y - particle.y, this.mouse.x - particle.x);
            const force = (150 - mouseDistance) / 150;
            particle.vx += Math.cos(angle) * force * 0.01;
            particle.vy += Math.sin(angle) * force * 0.01;
          }
          
          // Dampen velocity
          particle.vx *= 0.99;
          particle.vy *= 0.99;
        });
      }
      
      draw() {
        // Clear canvas with subtle fade effect
        this.ctx.fillStyle = 'rgba(2, 6, 23, 0.1)';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Draw connections
        this.connections.forEach(connection => {
          const from = this.particles[connection.from];
          const to = this.particles[connection.to];
          
          if (from && to) {
            const alpha = 0.3 + Math.sin(connection.pulse) * 0.2;
            this.ctx.strokeStyle = `rgba(99, 102, 241, ${alpha * connection.strength})`;
            this.ctx.lineWidth = 1 * connection.strength;
            this.ctx.beginPath();
            this.ctx.moveTo(from.x, from.y);
            this.ctx.lineTo(to.x, to.y);
            this.ctx.stroke();
            
            connection.pulse += 0.01;
          }
        });
        
        // Draw particles
        this.particles.forEach(particle => {
          const alpha = 0.6 + Math.sin(particle.pulse) * 0.4;
          this.ctx.fillStyle = particle.color.replace('0.6)', `${alpha})`);
          this.ctx.beginPath();
          this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
          this.ctx.fill();
        });
      }
      
      animate() {
        this.updateParticles();
        this.draw();
        this.animationId = requestAnimationFrame(() => this.animate());
      }
      
      destroy() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
        }
      }
    }

    // Initialize AI Neural Network when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', async () => {
        new AINeuralNetwork();
        initializeServicePackageBuilder();
        await initializeStripeAndConfig();
        updateStripeCartDisplay(); // Initialize cart display
        initializeServicesPortfolioGrids();
      });
    } else {
      (async () => {
        new AINeuralNetwork();
        initializeServicePackageBuilder();
        await initializeStripeAndConfig();
        updateStripeCartDisplay(); // Initialize cart display
        initializeServicesPortfolioGrids();
      })();
    }

    // ========================================
    // SERVICE PACKAGE BUILDER SYSTEM
    // ========================================
    function initializeServicePackageBuilder() {
      const serviceItems = document.querySelectorAll('.service-item');
      const packageDropzone = document.getElementById('packageDropzone');
      const selectedServices = document.getElementById('selectedServices');
      const quoteSummary = document.getElementById('quoteSummary');
      const categoryTabs = document.querySelectorAll('.category-tab');
      const generateInvoiceBtn = document.getElementById('generateInvoice');
      const clearPackageBtn = document.getElementById('clearPackage');
      
      let selectedServicesList = [];
      let currentCategory = 'website';
      
      console.log('Initializing Service Package Builder...');
      
      // Service data with complete Cochran Films pricing
      const serviceData = {
        // Website Development Packages
        'starter-site': { name: 'Starter Site', price: 750, duration: 'Basic SEO setup', icon: 'fas fa-laptop-code', category: 'website' },
        'business-pro-site': { name: 'Business Pro Site', price: 1250, duration: 'Mobile & tablet optimization', icon: 'fas fa-globe', category: 'website' },
        'brand-builder-site': { name: 'Brand Builder Site', price: 2500, duration: 'Full SEO + Analytics', icon: 'fas fa-rocket', category: 'website' },
        
        // Photography Services
        'flash-start': { name: 'Flash Start', price: 350, duration: 'Online Gallery Delivery', icon: 'fas fa-camera', category: 'photography' },
        'prime-exposure': { name: 'Prime Exposure', price: 600, duration: 'Online Gallery + Download', icon: 'fas fa-camera-retro', category: 'photography' },
        'legacy-capture': { name: 'Legacy Capture', price: 900, duration: 'Social Media Highlights', icon: 'fas fa-award', category: 'photography' },
        
        // Video Services
        'hourly-video': { name: 'Hourly Video Service', price: 250, duration: 'Per Hour', icon: 'fas fa-clock', category: 'videography' },
        'event-video-2hr': { name: 'Event Video + 60 Sec Recap', price: 500, duration: '2 Hours', icon: 'fas fa-video', category: 'videography' },
        'event-video-3hr': { name: 'Event Video + 60 Sec Recap', price: 750, duration: '3 Hours', icon: 'fas fa-film', category: 'videography' },
        'event-video-5hr': { name: 'Event Video + 60-90 Sec Recap', price: 1250, duration: '5 Hours', icon: 'fas fa-camera', category: 'videography' },
        'live-production-3hr': { name: 'Live Production (Up to 3 Cameras)', price: 2000, duration: '3 Hours + Edit', icon: 'fas fa-broadcast-tower', category: 'videography' },
        'live-production-5hr': { name: 'Live Production (Up to 3 Cameras)', price: 3000, duration: '5 Hours + Edit', icon: 'fas fa-satellite-dish', category: 'videography' },
        'live-production-8hr': { name: 'Live Production (Up to 3 Cameras)', price: 4000, duration: '8 Hours + Edit', icon: 'fas fa-tower-broadcast', category: 'videography' },
        'podcast-1hr': { name: 'Podcast + Edits (2 Cameras)', price: 750, duration: '1 Hour', icon: 'fas fa-podcast', category: 'videography' },
        'podcast-2hr': { name: 'Podcast + Edits (2 Cameras)', price: 1000, duration: '2 Hours', icon: 'fas fa-microphone', category: 'videography' },
        'podcast-3hr': { name: 'Podcast + Edits (2 Cameras)', price: 1500, duration: '3 Hours', icon: 'fas fa-headphones', category: 'videography' },
        'commercial-basic': { name: 'Basic Commercial Shoot', price: 750, duration: 'Single Camera, 3 Hours', icon: 'fas fa-ad', category: 'videography' },
        'commercial-edit': { name: 'Commercial Shoot + Edit', price: 1500, duration: 'Single Camera, 3-5 hrs + Edit', icon: 'fas fa-cut', category: 'videography' },
        'commercial-directed': { name: 'Directed Commercial Shoot', price: 2500, duration: 'Pre-Production + 4-6 hrs + Edit', icon: 'fas fa-bullhorn', category: 'videography' },
        'commercial-full': { name: 'Full Commercial Package', price: 5500, duration: 'Full Creative Direction + Crew', icon: 'fas fa-crown', category: 'videography' },
        
        // Brand Building Services
        'ignite-brand': { name: 'Ignite Package', price: 900, duration: '2 Branded Graphics', icon: 'fas fa-fire', category: 'branding' },
        'collaborate-brand': { name: 'Collaborate Package', price: 1800, duration: 'Short Promotional Video', icon: 'fas fa-handshake', category: 'branding' },
        'transform-brand': { name: 'Transform Package', price: 3500, duration: '2 Promotional Videos', icon: 'fas fa-magic', category: 'branding' },
        'logo-design': { name: 'Logo Design', price: 250, duration: 'Color palette & fonts', icon: 'fas fa-palette', category: 'branding' },
        
        // Printing Services
        'quick-print-4x6': { name: 'Quick Print Booth (4x6)', price: 500, duration: '4x6 Prints', icon: 'fas fa-print', category: 'printing' },
        'signature-snap-4x6': { name: 'Signature Snap Station (4x6)', price: 800, duration: 'Table Setup & Lighting', icon: 'fas fa-images', category: 'printing' },
        'legacy-lab-4x6': { name: 'Legacy Lab Experience (4x6)', price: 1100, duration: 'Real-time photo review', icon: 'fas fa-trophy', category: 'printing' },
        
        // Website Add-ons
        'seo-boost': { name: 'SEO Boost Package', price: 250, duration: 'Google submission', icon: 'fas fa-chart-line', category: 'website' },
        'google-business': { name: 'Google Business Profile Setup', price: 100, duration: 'Link to website', icon: 'fab fa-google', category: 'website' },
        'newsletter-integration': { name: 'Newsletter Integration', price: 125, duration: 'Email platform link', icon: 'fas fa-envelope', category: 'website' },
        
        // Website Maintenance Plans
        'basic-maintenance': { name: 'Basic Maintenance', price: 45, duration: 'Per month', icon: 'fas fa-tools', category: 'website' },
        'business-maintenance': { name: 'Business Maintenance', price: 95, duration: 'Per month', icon: 'fas fa-cogs', category: 'website' },
        'full-support': { name: 'Full Support Plan', price: 195, duration: 'Per month', icon: 'fas fa-shield-alt', category: 'website' }
      };
      
      // Category tab functionality
      categoryTabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
          e.preventDefault();
          const category = tab.dataset.category;
          currentCategory = category;
          
          // Update active tab
          categoryTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Filter services
          filterServicesByCategory(category);
        });
      });
      
      // Initialize with default category
      setTimeout(() => {
        categoryTabs.forEach(t => t.classList.remove('active'));
        const activeTab = document.querySelector(`[data-category="${currentCategory}"]`);
        if (activeTab) {
          activeTab.classList.add('active');
        }
        filterServicesByCategory(currentCategory);
      }, 200);
      
      // Filter services by category
      function filterServicesByCategory(category) {
        const allItems = document.querySelectorAll('.service-item, .service-section-header');
        
        allItems.forEach((item) => {
          const itemCategory = item.dataset.category;
          const shouldShow = category === 'all' || itemCategory === category;
          
          if (shouldShow) {
            item.style.display = 'block';
            item.style.visibility = 'visible';
            item.style.opacity = '1';
            item.classList.remove('hidden');
          } else {
            item.style.display = 'none';
            item.style.visibility = 'hidden';
            item.style.opacity = '0';
            item.classList.add('hidden');
          }
        });
        
        // Reinitialize listeners after filtering
        setTimeout(() => {
          initializeServiceListeners();
        }, 10);
      }
      
      // Drag and drop event handlers
      let isDragging = false;
      
      function handleDragStart(e) {
        const serviceItem = e.target.closest('.service-item');
        serviceItem.classList.add('dragging');
        isDragging = true;
        e.dataTransfer.setData('text/plain', serviceItem.dataset.service);
        e.dataTransfer.effectAllowed = 'copy';
      }
      
      function handleDragEnd(e) {
        const serviceItem = e.target.closest('.service-item');
        serviceItem.classList.remove('dragging');
        setTimeout(() => { isDragging = false; }, 100);
      }
      
      function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
      }
      
      function handleDragEnter(e) {
        e.preventDefault();
        if (packageDropzone) {
          packageDropzone.classList.add('drag-over');
        }
      }
      
      function handleDragLeave(e) {
        if (packageDropzone && !packageDropzone.contains(e.relatedTarget)) {
          packageDropzone.classList.remove('drag-over');
        }
      }
      
      function handleDrop(e) {
        e.preventDefault();
        if (packageDropzone) {
          packageDropzone.classList.remove('drag-over');
        }
        
        const serviceId = e.dataTransfer.getData('text/plain');
        if (serviceId) {
          addServiceToPackage(serviceId);
          showNotification('Service added to package!', 'success');
        }
      }

      // Initialize drag and drop functionality
      function initializeServiceListeners() {
        const allServiceItems = document.querySelectorAll('.service-item');
        allServiceItems.forEach(item => {
          item.addEventListener('dragstart', handleDragStart);
          item.addEventListener('dragend', handleDragEnd);
          item.addEventListener('click', handleServiceClick);
        });
      }
      
      // Initialize listeners
      initializeServiceListeners();
      
      if (packageDropzone) {
        packageDropzone.addEventListener('dragover', handleDragOver);
        packageDropzone.addEventListener('drop', handleDrop);
        packageDropzone.addEventListener('dragenter', handleDragEnter);
        packageDropzone.addEventListener('dragleave', handleDragLeave);
      }
      
      // Button event listeners
      if (generateInvoiceBtn) {
        generateInvoiceBtn.addEventListener('click', generateInvoice);
      }
      if (clearPackageBtn) {
        clearPackageBtn.addEventListener('click', clearPackage);
      }
      
      function addServiceToPackage(serviceId) {
        const service = serviceData[serviceId];
        if (!service) return;
        
        const existingService = selectedServicesList.find(s => s.id === serviceId);
        if (existingService) {
          existingService.quantity++;
        } else {
          selectedServicesList.push({
            id: serviceId,
            name: service.name,
            price: service.price,
            duration: service.duration,
            icon: service.icon,
            category: service.category,
            quantity: 1
          });
        }
        
        updatePackageDisplay();
        updateQuoteSummary();
      }
      
      function removeServiceFromPackage(serviceId) {
        selectedServicesList = selectedServicesList.filter(s => s.id !== serviceId);
        updatePackageDisplay();
        updateQuoteSummary();
        showNotification('Service removed from package', 'info');
      }
      
      // Make removeServiceFromPackage globally accessible
      window.removeServiceFromPackage = removeServiceFromPackage;
      
      function updatePackageDisplay() {
        if (selectedServicesList.length === 0) {
          selectedServices.style.display = 'none';
          quoteSummary.style.display = 'none';
          packageDropzone.querySelector('.dropzone-placeholder').style.display = 'block';
        } else {
          selectedServices.style.display = 'block';
          quoteSummary.style.display = 'block';
          packageDropzone.querySelector('.dropzone-placeholder').style.display = 'none';
          
          selectedServices.innerHTML = selectedServicesList.map(service => `
            <div class="selected-service">
              <div class="selected-service-info">
                <div class="selected-service-icon">
                  <i class="${service.icon}"></i>
                </div>
                <div class="selected-service-details">
                  <h5>${service.name}</h5>
                  <p>${service.duration} - $${service.price}</p>
                </div>
              </div>
              <button class="remove-service" onclick="removeServiceFromPackage('${service.id}')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `).join('');
        }
      }
      
      function updateQuoteSummary() {
        const total = selectedServicesList.reduce((sum, service) => sum + (service.price * service.quantity), 0);
        
        document.getElementById('quoteTotal').textContent = `$${total.toFixed(2)}`;
        
        const breakdown = document.getElementById('quoteBreakdown');
        breakdown.innerHTML = `
          <div class="quote-item">
            <span class="quote-item-label">Subtotal</span>
            <span class="quote-item-value">$${total.toFixed(2)}</span>
          </div>
          <div class="quote-item">
            <span class="quote-item-label">Total</span>
            <span class="quote-item-value">$${total.toFixed(2)}</span>
          </div>
        `;
      }
      
      function clearPackage() {
        selectedServicesList = [];
        updatePackageDisplay();
        updateQuoteSummary();
      }
      
      function generateInvoice() {
        if (selectedServicesList.length === 0) {
          showNotification('Please add services to your package first!', 'error');
          return;
        }
        
        const invoiceData = {
          services: selectedServicesList,
          subtotal: selectedServicesList.reduce((sum, service) => sum + (service.price * service.quantity), 0),
          total: selectedServicesList.reduce((sum, service) => sum + (service.price * service.quantity), 0),
          date: new Date().toISOString(),
          invoiceNumber: 'CF-' + Date.now()
        };
        
        showInvoiceModal(invoiceData);
      }
      
      function showInvoiceModal(invoiceData) {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay active';
        modal.innerHTML = `
          <div class="modal-content">
            <button class="modal-close" onclick="this.parentElement.parentElement.remove()">×</button>
            <div class="modal-header">
              <div class="modal-icon">
                <i class="fas fa-file-invoice"></i>
              </div>
              <h2>Project Request Ready</h2>
              <p>Your project request has been prepared and is ready to be submitted</p>
            </div>
            
            <div class="invoice-details">
              <div class="invoice-header">
                <h3>Invoice #${invoiceData.invoiceNumber}</h3>
                <p>Date: ${new Date(invoiceData.date).toLocaleDateString()}</p>
              </div>
              
              <div class="invoice-items">
                ${invoiceData.services.map(service => `
                  <div class="invoice-item">
                    <div class="item-details">
                      <h4>${service.name}</h4>
                      <p>${service.duration}</p>
                    </div>
                    <div class="item-price">
                      <span>$${service.price.toFixed(2)}</span>
                    </div>
                  </div>
                `).join('')}
              </div>
              
              <div class="invoice-total">
                <div class="total-line">
                  <span>Subtotal:</span>
                  <span>$${invoiceData.subtotal.toFixed(2)}</span>
                </div>
                <div class="total-line total">
                  <span>Total:</span>
                  <span>$${invoiceData.total.toFixed(2)}</span>
                </div>
              </div>
            </div>
            
            <div class="contact-form-section">
              <h3>Contact Information</h3>
              <p>Please provide your contact details to send your project request</p>
              
              <div class="contact-form">
                <div class="form-group">
                  <label for="customerName">Full Name *</label>
                  <input type="text" id="customerName" required placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                  <label for="customerEmail">Email Address *</label>
                  <input type="email" id="customerEmail" required placeholder="Enter your email address">
                </div>
                
                <div class="form-group">
                  <label for="customerPhone">Phone Number *</label>
                  <input type="tel" id="customerPhone" required placeholder="Enter your phone number">
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button class="btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
                <i class="fas fa-times"></i>
                Close
              </button>
              <button class="btn-primary" onclick="validateAndSendProject(${JSON.stringify(invoiceData).replace(/"/g, '&quot;')})">
                <i class="fas fa-paper-plane"></i>
                Send Your Project
              </button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
      }
      
      // Validate contact information and send project
      function validateAndSendProject(invoiceData) {
        const customerName = document.getElementById('customerName').value.trim();
        const customerEmail = document.getElementById('customerEmail').value.trim();
        const customerPhone = document.getElementById('customerPhone').value.trim();
        
        if (!customerName || !customerEmail || !customerPhone) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }
        
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(customerEmail)) {
          showNotification('Please enter a valid email address', 'error');
          return;
        }
        
        invoiceData.customer = {
          name: customerName,
          email: customerEmail,
          phone: customerPhone
        };
        
        sendToEmailJS(invoiceData);
      }
      
      // Make functions globally available
      window.removeServiceFromPackage = removeServiceFromPackage;
      window.validateAndSendProject = validateAndSendProject;
      
      function sendToEmailJS(invoiceData) {
        const submitBtn = document.querySelector('.btn-primary');
        const originalText = submitBtn.innerHTML;
        
        if (submitBtn.disabled) return;
        
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending Request...';
        submitBtn.disabled = true;
        
        const serviceDetails = invoiceData.services.map(s => {
          let serviceDetail = `- ${s.name}: $${s.price}`;
          return serviceDetail;
        }).join('\n');
        
        const customerInfo = invoiceData.customer || {};
        const customerName = customerInfo.name || 'Unknown Customer';
        const customerEmail = customerInfo.email || 'No email provided';
        const customerPhone = customerInfo.phone || 'No phone provided';
        
        emailjs.send('service_t11yvru', 'template_aluwel1', {
          service: 'Project Generation',
          name: customerName,
          email: customerEmail,
          phone: customerPhone,
          notes: `Invoice #${invoiceData.invoiceNumber}\n\nCustomer Details:\nName: ${customerName}\nEmail: ${customerEmail}\nPhone: ${customerPhone}\n\nServices:\n${serviceDetails}\n\nSubtotal: $${invoiceData.subtotal.toFixed(2)}\nTotal: $${invoiceData.total.toFixed(2)}\n\nGenerated: ${new Date(invoiceData.date).toLocaleString()}`,
          invoice_number: invoiceData.invoiceNumber,
          total_amount: `$${invoiceData.total.toFixed(2)}`,
          title: 'Service Package Request'
        })
        .then(function(response) {
          console.log('Project request sent successfully');
          showSuccessModal();
          clearPackage();
        })
        .catch(function(error) {
          console.error('EmailJS error:', error);
          showSuccessModal();
          clearPackage();
        });
      }
      
      function showSuccessModal() {
        const existingModals = document.querySelectorAll('.modal-overlay:not(.success-modal-overlay)');
        existingModals.forEach(modal => modal.remove());
        
        const modal = document.createElement('div');
        modal.className = 'modal-overlay active success-modal-overlay';
        modal.innerHTML = `
          <div class="modal-content">
            <div class="success-modal-header">
              <div class="success-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <h2>✅ Request Submitted!</h2>
              <p>Thank you for reaching out. We'll review your request and get back to you within 24 hours.</p>
            </div>
            
            <div class="success-modal-body">
              <div class="success-details">
                <div class="success-detail-item">
                  <i class="fas fa-clock"></i>
                  <span>Response time: Within 24 hours</span>
                </div>
                <div class="success-detail-item">
                  <i class="fas fa-envelope"></i>
                  <span>We'll contact you via email</span>
                </div>
                <div class="success-detail-item">
                  <i class="fas fa-phone"></i>
                  <span>Questions? Call us anytime</span>
                </div>
              </div>
            </div>
            
            <div class="success-modal-actions">
              <button class="btn-primary success-btn" onclick="handleAwesomeClick()">
                <i class="fas fa-thumbs-up"></i>
                Awesome, Thanks!
              </button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        setTimeout(() => {
          const stillExists = document.querySelector('.success-modal-overlay');
          if (stillExists) {
            closeAllModalsAndReset();
          }
        }, 8000);
      }
      
      function closeAllModalsAndReset() {
        const allModals = document.querySelectorAll('.modal-overlay');
        allModals.forEach((modal, index) => {
          modal.remove();
        });
        
        const submitButtons = document.querySelectorAll('.btn-primary');
        submitButtons.forEach(btn => {
          if (btn.textContent.includes('Send Your Project') || btn.textContent.includes('Sending Request') || btn.textContent.includes('Submitted')) {
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Your Project';
            btn.disabled = false;
          }
        });
      }
      
      // Make function globally available
      window.closeAllModalsAndReset = closeAllModalsAndReset;
      
      function handleServiceClick(e) {
        if (isDragging) return;
        
        const serviceItem = e.target.closest('.service-item');
        if (!serviceItem) return;
        
        const serviceId = serviceItem.dataset.service;
        if (serviceId) {
          e.preventDefault();
          e.stopPropagation();
          addServiceToPackage(serviceId);
          showNotification('Service added to package!', 'success');
        }
      }
      
      function handleAwesomeClick() {
        const awesomeBtn = event.target.closest('button');
        if (awesomeBtn) {
          awesomeBtn.innerHTML = '<i class="fas fa-check"></i> Thanks!';
          awesomeBtn.disabled = true;
        }
        
        setTimeout(() => {
          closeAllModalsAndReset();
        }, 300);
      }
      
      // Make functions globally available
      window.handleAwesomeClick = handleAwesomeClick;
      
      // Simple notification system
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
          <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
          </div>
        `;
        
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#6366f1'};
          color: white;
          padding: 1rem 1.5rem;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 10001;
          transform: translateX(100%);
          transition: transform 0.3s ease;
          max-width: 300px;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }
    }

    // ========================================
    // STRIPE INTEGRATION SYSTEM
    // ========================================
    async function initializeStripeAndConfig() {
      try {
        const resp = await fetch('/api/config', { cache: 'no-store' });
        const { publishableKey } = await resp.json();
        stripe = Stripe(publishableKey);
      } catch (e) {
        console.error('Failed to load Stripe publishable key, falling back to test key.', e);
        stripe = Stripe('pk_test_YOUR_PUBLISHABLE_KEY_HERE');
      }
      return initializeStripeIntegration();
    }

    function initializeStripeIntegration() {
      console.log('🚀 Initializing Stripe Integration...');
      
      // Cart toggle functionality
      const cartToggle = document.getElementById('stripeCartToggle');
      const cart = document.getElementById('stripeCart');
      const cartClose = document.getElementById('stripeCartClose');
      
      if (cartToggle && cart && cartClose) {
        console.log('Cart elements found, setting up toggle functionality');
        cartToggle.addEventListener('click', () => {
          console.log('Cart toggle clicked, current state:', cart.classList.contains('show'));
          cart.classList.toggle('show');
        });
        
        cartClose.addEventListener('click', () => {
          console.log('Cart close clicked');
          cart.classList.remove('show');
        });
        
        document.addEventListener('click', (e) => {
          if (!cart.contains(e.target) && !cartToggle.contains(e.target)) {
            cart.classList.remove('show');
          }
        });
      } else {
        console.error('Cart elements not found:', { cartToggle, cart, cartClose });
      }
      
      // Cart actions
      const cartCheckout = document.getElementById('stripeCartCheckout');
      const cartClear = document.getElementById('stripeCartClear');
      
      if (cartCheckout) {
        cartCheckout.addEventListener('click', () => {
          if (window.stripeCart.items.length > 0) {
            processStripeCheckout();
          } else {
            showNotification('Your cart is empty!', 'error');
          }
        });
      }
      const cartInvoice = document.getElementById('stripeCartInvoice');
      if (cartInvoice) {
        cartInvoice.addEventListener('click', () => {
          if (window.stripeCart.items.length > 0) {
            showInvoiceCreateModal();
          } else {
            showNotification('Your cart is empty!', 'error');
          }
        });
      }
      
      if (cartClear) {
        cartClear.addEventListener('click', () => {
          clearStripeCart();
        });
      }
      
      // Service detail modal functionality
      const serviceDetailModal = document.getElementById('serviceDetailModal');
      const serviceDetailClose = document.getElementById('serviceDetailClose');
      
      if (serviceDetailClose) {
        serviceDetailClose.addEventListener('click', () => {
          serviceDetailModal.classList.remove('show');
        });
      }
      
      if (serviceDetailModal) {
        serviceDetailModal.addEventListener('click', (e) => {
          if (e.target === serviceDetailModal) {
            serviceDetailModal.classList.remove('show');
          }
        });
      }
      
      // Add click handlers to service cards
      addServiceCardClickHandlers();
      
      console.log('✅ Stripe Integration initialized successfully');
    }

    // Add click handlers to service cards
    function addServiceCardClickHandlers() {
      const serviceCards = document.querySelectorAll('.service-card');
      
      serviceCards.forEach(card => {
        card.addEventListener('click', (e) => {
          if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') {
            return;
          }
          
          const serviceType = getServiceTypeFromCard(card);
          if (serviceType) {
            console.log('Service card clicked:', serviceType);
            showServiceDetailModal(serviceType);
          }
        });
        
        card.style.cursor = 'pointer';
      });
    }

    // Determine service type from service card
    function getServiceTypeFromCard(card) {
      const title = card.querySelector('.service-title')?.textContent?.toLowerCase();
      
      if (title?.includes('video')) return 'video-production';
      if (title?.includes('photo')) return 'photography';
      if (title?.includes('web')) return 'web-development';
      if (title?.includes('brand')) return 'brand-development';
      if (title?.includes('white')) return 'white-label-services';
      if (title?.includes('workshop')) return 'workshops-training';
      
      return null;
    }

    // Show service detail modal
    function showServiceDetailModal(serviceType) {
      const service = stripeServiceDatabase[serviceType];
      if (!service) return;
      
      const modal = document.getElementById('serviceDetailModal');
      const icon = document.getElementById('serviceDetailIcon');
      const title = document.getElementById('serviceDetailTitle');
      const price = document.getElementById('serviceDetailPrice');
      const description = document.getElementById('serviceDetailDescription');
      const features = document.getElementById('serviceDetailFeatures');
      const addCartBtn = document.getElementById('serviceDetailAddCart');
      const checkoutBtn = document.getElementById('serviceDetailCheckout');
      
      if (icon) icon.innerHTML = `<i class="${service.icon}"></i>`;
      if (title) title.textContent = service.name;
      if (price) price.textContent = `$${service.price.toLocaleString()}`;
      if (description) description.textContent = service.description;
      
      if (features) {
        const catalog = getCatalogForService(serviceType);
        const packagesHtml = catalog.packages.length ? `
          <div style="margin: 16px 0 10px; font-weight:700; color: var(--text-primary);">Packages</div>
          <div id="servicePackageOptions" style="display:flex; flex-direction:column; gap:10px;">
            ${catalog.packages.map((pkg, idx) => `
              <label style="display:flex; align-items:center; gap:10px; padding:10px; border:1px solid rgba(148,163,184,0.25); border-radius:10px; cursor:pointer;">
                <input type="radio" name="service-package" value="${pkg.id}" ${idx===0?'checked':''} />
                <span style="flex:1; color: var(--text-secondary);">${pkg.name}</span>
                <span style="color: var(--brand-gold); font-weight:800;">$${pkg.price.toLocaleString()}</span>
              </label>
            `).join('')}
          </div>
        ` : '';

        const addOnsHtml = catalog.addOns.length ? `
          <div style="margin: 18px 0 10px; font-weight:700; color: var(--text-primary);">Add-ons</div>
          <div id="serviceAddOnOptions" style="display:flex; flex-direction:column; gap:8px;">
            ${catalog.addOns.map(add => `
              <label style="display:flex; align-items:center; gap:10px; padding:10px; border:1px solid rgba(148,163,184,0.2); border-radius:10px;">
                <input type="checkbox" name="service-addon" value="${add.id}" data-price="${add.price}" />
                <span style="flex:1; color: var(--text-secondary);">${add.name}</span>
                <span style="color: var(--brand-gold); font-weight:800;">$${add.price.toLocaleString()}</span>
              </label>
            `).join('')}
          </div>
        ` : '';

        features.innerHTML = `
          ${service.features && service.features.length ? service.features.map(feature => `<li><i class="fas fa-check"></i>${feature}</li>`).join('') : ''}
          ${packagesHtml}
          ${addOnsHtml}
        `;
      }
      
      function getSelectedPackageAndAddOns() {
        const catalog = getCatalogForService(serviceType);
        const selectedPkgId = (document.querySelector('input[name="service-package"]:checked')?.value) || null;
        const selectedPackage = catalog.packages.find(p => p.id === selectedPkgId) || null;
        const selectedAddOns = Array.from(document.querySelectorAll('input[name="service-addon"]:checked')).map(cb => {
          const id = cb.value;
          const meta = catalog.addOns.find(a => a.id === id);
          return meta ? { id: meta.id, name: meta.name, price: meta.price } : null;
        }).filter(Boolean);
        return { selectedPackage, selectedAddOns };
      }

      if (addCartBtn) {
        addCartBtn.onclick = () => {
          const { selectedPackage, selectedAddOns } = getSelectedPackageAndAddOns();
          if (selectedPackage) {
            addCompositeToCart(serviceType, service, selectedPackage, selectedAddOns);
            modal.classList.remove('show');
          } else {
            showNotification('Please select a package', 'error');
          }
        };
      }
      
      if (checkoutBtn) {
        checkoutBtn.onclick = () => {
          const { selectedPackage, selectedAddOns } = getSelectedPackageAndAddOns();
          if (selectedPackage) {
            addCompositeToCart(serviceType, service, selectedPackage, selectedAddOns);
            modal.classList.remove('show');
            processStripeCheckout();
          } else {
            showNotification('Please select a package', 'error');
          }
        };
      }
      
      modal.classList.add('show');
    }

    // Stripe service database
    const stripeServiceDatabase = {
      'video-production': {
        name: 'Video Production',
        price: 250,
        description: 'Professional video production including commercials, brand films, documentaries, and live event coverage.',
        icon: 'fas fa-video',
        features: [
          'Professional camera equipment',
          'High-quality audio recording',
          'Post-production editing',
          'Color grading & correction',
          'Final delivery in multiple formats',
          'Project consultation included'
        ],
        category: 'videography'
      },
      'photography': {
        name: 'Photography',
        price: 350,
        description: 'Live event printing, portraits, product photography, and event coverage with instant printing capabilities.',
        icon: 'fas fa-camera',
        features: [
          'Professional camera equipment',
          'Live event printing (4x6 & 5x7)',
          'Branded print templates',
          'Online gallery delivery',
          'Light photo editing included',
          'Unlimited digital photos'
        ],
        category: 'photography'
      },
      'web-development': {
        name: 'Web Development',
        price: 750,
        description: 'Custom website development and maintenance, from strategy and design to publishing and ongoing support.',
        icon: 'fas fa-code',
        features: [
          'Custom website design',
          'Mobile-responsive layout',
          'SEO optimization',
          'Content management system',
          'Contact form integration',
          '30-day post-launch support'
        ],
        category: 'website'
      },
      'brand-development': {
        name: 'Brand Development',
        price: 900,
        description: 'Complete brand identity development including logos, design systems, and strategic brand positioning.',
        icon: 'fas fa-palette',
        features: [
          'Custom logo design (2 concepts)',
          'Brand color palette',
          'Typography selection',
          'Brand guidelines document',
          'Social media templates',
          '1-page landing website'
        ],
        category: 'branding'
      },
      'white-label-services': {
        name: 'White-Label Services',
        price: 2000,
        description: 'Enterprise-ready sites and systems you can deploy under your brand.',
        icon: 'fas fa-users-gear',
        features: [
          'Custom-branded solutions',
          'Scalable architecture',
          'API integration',
          'Admin dashboard',
          'User management system',
          'Technical documentation'
        ],
        category: 'enterprise'
      },
      'workshops-training': {
        name: 'Web Development Workshop',
        price: 350,
        description: 'Build Your Website in Just 2 DAYS — With Expert Support Every Step of the Way.',
        icon: 'fas fa-graduation-cap',
        features: [
          '2-day intensive workshop',
          'Hands-on website building',
          'Expert guidance throughout',
          'Take-home project files',
          '30-day post-workshop support',
          'Certificate of completion'
        ],
        category: 'education'
      }
    };

    // Comprehensive service catalog with packages and add-ons (aligned with builder pricing)
    const CF_SERVICES_CATALOG = {
      'web-development': {
        packages: [
          { id: 'starter-site', name: 'Starter Site', price: 750 },
          { id: 'business-pro-site', name: 'Business Pro Site', price: 1250 },
          { id: 'brand-builder-site', name: 'Brand Builder Site', price: 2500 },
        ],
        addOns: [
          { id: 'seo-boost', name: 'SEO Boost Package', price: 250 },
          { id: 'google-business', name: 'Google Business Profile Setup', price: 100 },
          { id: 'newsletter-integration', name: 'Newsletter Integration', price: 125 },
          { id: 'basic-maintenance', name: 'Basic Maintenance (Monthly)', price: 45 },
          { id: 'business-maintenance', name: 'Business Maintenance (Monthly)', price: 95 },
          { id: 'full-support', name: 'Full Support Plan (Monthly)', price: 195 },
        ],
      },
      'photography': {
        packages: [
          { id: 'flash-start', name: 'Flash Start', price: 350 },
          { id: 'prime-exposure', name: 'Prime Exposure', price: 600 },
          { id: 'legacy-capture', name: 'Legacy Capture', price: 900 },
        ],
        addOns: [
          { id: 'quick-print-4x6', name: 'Quick Print Booth (4x6)', price: 500 },
          { id: 'signature-snap-4x6', name: 'Signature Snap Station (4x6)', price: 800 },
          { id: 'legacy-lab-4x6', name: 'Legacy Lab Experience (4x6)', price: 1100 },
        ],
      },
      'video-production': {
        packages: [
          { id: 'hourly-video', name: 'Hourly Video Service (Per Hour)', price: 250 },
          { id: 'event-video-2hr', name: 'Event Video + 60 Sec Recap (2 Hours)', price: 500 },
          { id: 'event-video-3hr', name: 'Event Video + 60 Sec Recap (3 Hours)', price: 750 },
          { id: 'event-video-5hr', name: 'Event Video + 60-90 Sec Recap (5 Hours)', price: 1250 },
          { id: 'live-production-3hr', name: 'Live Production (Up to 3 Cameras) - 3 Hours + Edit', price: 2000 },
          { id: 'live-production-5hr', name: 'Live Production (Up to 3 Cameras) - 5 Hours + Edit', price: 3000 },
          { id: 'live-production-8hr', name: 'Live Production (Up to 3 Cameras) - 8 Hours + Edit', price: 4000 },
          { id: 'podcast-1hr', name: 'Podcast + Edits (2 Cameras) - 1 Hour', price: 750 },
          { id: 'podcast-2hr', name: 'Podcast + Edits (2 Cameras) - 2 Hours', price: 1000 },
          { id: 'podcast-3hr', name: 'Podcast + Edits (2 Cameras) - 3 Hours', price: 1500 },
          { id: 'commercial-basic', name: 'Basic Commercial Shoot (Single Camera, 3 Hours)', price: 750 },
          { id: 'commercial-edit', name: 'Commercial Shoot + Edit (3-5 hrs + Edit)', price: 1500 },
          { id: 'commercial-directed', name: 'Directed Commercial Shoot (Pre-Pro + 4-6 hrs + Edit)', price: 2500 },
          { id: 'commercial-full', name: 'Full Commercial Package (Full Creative Direction + Crew)', price: 5500 },
        ],
        addOns: [],
      },
      'brand-development': {
        packages: [
          { id: 'ignite-brand', name: 'Ignite Package', price: 900 },
          { id: 'collaborate-brand', name: 'Collaborate Package', price: 1800 },
          { id: 'transform-brand', name: 'Transform Package', price: 3500 },
          { id: 'logo-design', name: 'Logo Design', price: 250 },
        ],
        addOns: [],
      },
      'white-label-services': {
        packages: [ { id: 'white-label-base', name: 'White-Label Services (Base)', price: 2000 } ],
        addOns: [],
      },
      'workshops-training': {
        packages: [ { id: 'web-dev-workshop', name: 'Web Development Workshop (2-Day)', price: 350 } ],
        addOns: [],
      },
    };

    function getCatalogForService(serviceType) {
      return CF_SERVICES_CATALOG[serviceType] || { packages: [], addOns: [] };
    }

    // Add item to Stripe cart
    function addToStripeCart(serviceType, service) {
      console.log('Adding to cart:', serviceType, service);
      
      const existingItem = window.stripeCart.items.find(item => item.id === serviceType);
      
      if (existingItem) {
        existingItem.quantity += 1;
        console.log('Updated existing item quantity:', existingItem.quantity);
      } else {
        window.stripeCart.items.push({
          id: serviceType,
          name: service.name,
          price: service.price,
          icon: service.icon,
          quantity: 1
        });
        console.log('Added new item to cart');
      }
      
      console.log('Cart items:', window.stripeCart.items);
      updateStripeCartDisplay();
      showNotification(`${service.name} added to cart!`, 'success');
    }

    // Add composite (package + add-ons) to cart
    function addCompositeToCart(serviceType, baseService, selectedPackage, selectedAddOns) {
      const compositeId = `${serviceType}:${selectedPackage.id}`;
      const displayName = `${baseService.name} — ${selectedPackage.name}`;
      const existing = window.stripeCart.items.find(item => item.id === compositeId);
      const addOnsTotal = (selectedAddOns || []).reduce((sum, a) => sum + a.price, 0);
      const unitPrice = selectedPackage.price + addOnsTotal;
      if (existing) {
        existing.quantity += 1;
      } else {
        window.stripeCart.items.push({
          id: compositeId,
          name: displayName,
          price: unitPrice,
          icon: baseService.icon,
          quantity: 1,
          meta: {
            serviceType,
            packageId: selectedPackage.id,
            addOns: selectedAddOns,
          }
        });
      }
      updateStripeCartDisplay();
      showNotification(`${displayName} added to cart!`, 'success');
    }

    // Remove item from Stripe cart
    function removeFromStripeCart(serviceType) {
      window.stripeCart.items = window.stripeCart.items.filter(item => item.id !== serviceType);
      updateStripeCartDisplay();
    }

    // Clear Stripe cart
    function clearStripeCart() {
      window.stripeCart.items = [];
      updateStripeCartDisplay();
      showNotification('Cart cleared!', 'info');
    }

    // Update Stripe cart display
    function updateStripeCartDisplay() {
      console.log('Updating cart display...');
      const cartItems = document.getElementById('stripeCartItems');
      const cartTotal = document.getElementById('stripeCartTotal');
      const cartCount = document.getElementById('stripeCartCount');
      const cartToggle = document.getElementById('stripeCartToggle');
      
      console.log('Cart elements found:', { cartItems, cartTotal, cartCount, cartToggle });
      
      if (cartItems) {
        if (window.stripeCart.items.length === 0) {
          cartItems.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Your cart is empty</p>';
        } else {
          cartItems.innerHTML = window.stripeCart.items.map(item => `
            <div class="stripe-cart-item">
              <div class="stripe-cart-item-info">
                <h4>${item.name}</h4>
                <p>Qty: ${item.quantity} × $${item.price}</p>
              </div>
              <div class="stripe-cart-item-price">$${(item.price * item.quantity).toLocaleString()}</div>
              <button class="stripe-cart-item-remove" onclick="removeFromStripeCart('${item.id}')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `).join('');
        }
      }
      
      const total = window.stripeCart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      if (cartTotal) cartTotal.textContent = `$${total.toLocaleString()}`;
      
      const count = window.stripeCart.items.reduce((sum, item) => sum + item.quantity, 0);
      if (cartCount) cartCount.textContent = count;
      
      // Always show the cart toggle button, but hide count when empty
      if (cartToggle) {
        cartToggle.style.display = 'flex';
        console.log('Cart toggle display set to flex');
      }
      
      if (cartCount) {
        cartCount.style.display = count > 0 ? 'flex' : 'none';
        console.log('Cart count display set to:', count > 0 ? 'flex' : 'none');
      }
      
      window.stripeCart.total = total;
      console.log('Cart display updated. Items:', window.stripeCart.items.length, 'Total:', total, 'Count:', count);
    }

    // Process Stripe checkout
    async function processStripeCheckout() {
      if (window.stripeCart.items.length === 0) {
        showNotification('Your cart is empty!', 'error');
        return;
      }
      
      try {
        const lineItems = window.stripeCart.items.map(item => ({
          price_data: {
            currency: 'usd',
            product_data: {
              name: item.name,
              description: `Cochran Films - ${item.name}`,
              images: ['https://www.cochranfilms.com/CF_Logo_Black.png']
            },
            unit_amount: item.price * 100,
          },
          quantity: item.quantity,
        }));
        
        const response = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            line_items: lineItems,
            mode: 'payment',
            success_url: `${window.location.origin}/success.html`,
            cancel_url: `${window.location.origin}/cancel.html`,
            metadata: {
              customer_email: 'customer@example.com',
              service_types: window.stripeCart.items.map(item => item.id).join(','),
              total_amount: window.stripeCart.total.toString()
            }
          }),
        });
        
        if (!response.ok) {
          throw new Error('Failed to create checkout session');
        }
        
        const session = await response.json();
        
        const result = await stripe.redirectToCheckout({
          sessionId: session.id,
        });
        
        if (result.error) {
          showNotification('Checkout failed: ' + result.error.message, 'error');
        }
        
      } catch (error) {
        console.error('Checkout error:', error);
        showManualCheckoutInstructions();
      }
    }

    // Fallback manual checkout instructions
    function showManualCheckoutInstructions() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-icon">
              <i class="fas fa-credit-card"></i>
            </div>
            <h2>Manual Checkout</h2>
            <p>Please contact us to complete your purchase</p>
          </div>
          
          <div class="invoice-details">
            <div class="invoice-header">
              <h3>Order Summary</h3>
              <p>Total: $${window.stripeCart.total.toLocaleString()}</p>
            </div>
            
            <div class="invoice-items">
              ${window.stripeCart.items.map(item => `
                <div class="invoice-item">
                  <div class="item-details">
                    <h4>${item.name}</h4>
                    <p>Qty: ${item.quantity}</p>
                  </div>
                  <div class="item-price">$${(item.price * item.quantity).toLocaleString()}</div>
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="contact-form-section">
            <h3>Contact Information</h3>
            <p>We'll get back to you within 2 hours to complete your purchase</p>
            
            <div class="contact-form">
              <div class="form-group">
                <label for="manualName">Full Name *</label>
                <input type="text" id="manualName" required placeholder="Enter your full name">
              </div>
              
              <div class="form-group">
                <label for="manualEmail">Email Address *</label>
                <input type="email" id="manualEmail" required placeholder="Enter your email address">
              </div>
              
              <div class="form-group">
                <label for="manualPhone">Phone Number</label>
                <input type="tel" id="manualPhone" placeholder="Enter your phone number">
              </div>
            </div>
          </div>
          
          <div class="form-actions">
            <button class="btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
              <i class="fas fa-times"></i>
              Close
            </button>
            <button class="btn-primary" onclick="submitManualOrder()">
              <i class="fas fa-paper-plane"></i>
              Submit Order
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Show invoice modal to collect customer info and create Stripe invoice
    function showInvoiceCreateModal() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-icon"><i class="fas fa-file-invoice"></i></div>
            <h2>Create Invoice</h2>
            <p>Enter your details and we’ll generate a Stripe invoice you can pay online.</p>
          </div>
          <div class="contact-form">
            <div class="form-group">
              <label for="invoiceName">Full Name *</label>
              <input type="text" id="invoiceName" required placeholder="Enter your full name">
            </div>
            <div class="form-group">
              <label for="invoiceEmail">Email Address *</label>
              <input type="email" id="invoiceEmail" required placeholder="Enter your email address">
            </div>
          </div>
          <div class="form-actions">
            <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">
              <i class="fas fa-times"></i>
              Cancel
            </button>
            <button class="btn-primary" id="invoiceCreateBtn">
              <i class="fas fa-file-invoice-dollar"></i>
              Generate Invoice
            </button>
          </div>
          <div id="invoiceResult" style="margin-top:12px; display:none; text-align:center;"></div>
        </div>
      `;
      document.body.appendChild(modal);

      const btn = modal.querySelector('#invoiceCreateBtn');
      const result = modal.querySelector('#invoiceResult');
      btn.addEventListener('click', async () => {
        const name = modal.querySelector('#invoiceName').value.trim();
        const email = modal.querySelector('#invoiceEmail').value.trim();
        if (!name || !email) { showNotification('Please fill in name and email', 'error'); return; }
        btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
        try {
          const payload = {
            customer: { name, email },
            items: window.stripeCart.items.map(it => ({ id: it.id, name: it.name, price: it.price, quantity: it.quantity })),
            metadata: { source: 'services.html' }
          };
          const resp = await fetch('/api/create-invoice', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
          if (!resp.ok) throw new Error('Failed to create invoice');
          const data = await resp.json();
          result.style.display = 'block';
          result.innerHTML = `<a class="nav-link" style="display:inline-block;" href="${data.hostedInvoiceUrl}" target="_blank" rel="noopener"><i class='fas fa-external-link-alt'></i> Open Stripe Invoice</a>`;
          showNotification('Invoice created!', 'success');
        } catch (e) {
          showNotification('Could not create invoice. Please try again.', 'error');
        } finally {
          btn.disabled = false; btn.innerHTML = '<i class="fas fa-file-invoice-dollar"></i> Generate Invoice';
        }
      });
    }

    // Submit manual order
    function submitManualOrder() {
      const name = document.getElementById('manualName').value.trim();
      const email = document.getElementById('manualEmail').value.trim();
      const phone = document.getElementById('manualPhone').value.trim();
      
      if (!name || !email) {
        showNotification('Please fill in required fields', 'error');
        return;
      }
      
      const orderDetails = window.stripeCart.items.map(item => 
        `${item.name} (Qty: ${item.quantity}) - $${(item.price * item.quantity).toLocaleString()}`
      ).join('\n');
      
      emailjs.send('service_t11yvru', 'template_aluwel1', {
        service: 'Manual Order Submission',
        name: name,
        email: email,
        phone: phone,
        notes: `Manual Order - Total: $${window.stripeCart.total.toLocaleString()}\n\nItems:\n${orderDetails}\n\nCustomer Details:\nName: ${name}\nEmail: ${email}\nPhone: ${phone}`,
        title: 'Manual Order Request'
      })
      .then(function(response) {
        showNotification('Order submitted successfully! We\'ll contact you within 2 hours.', 'success');
        clearStripeCart();
        const modal = document.querySelector('.modal-overlay');
        if (modal) modal.remove();
      })
      .catch(function(error) {
        console.error('EmailJS error:', error);
        showNotification('Order submitted! We\'ll contact you within 2 hours.', 'success');
        clearStripeCart();
        const modal = document.querySelector('.modal-overlay');
        if (modal) modal.remove();
      });
    }

    // Simple notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#6366f1'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10001;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        max-width: 300px;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Stripe checkout processing
    function processStripeCheckout() {
      if (window.stripeCart.items.length === 0) {
        showNotification('Your cart is empty!', 'error');
        return;
      }
      
      // Create line items for Stripe
      const lineItems = window.stripeCart.items.map(item => ({
        price_data: {
          currency: 'usd',
          product_data: {
            name: item.name,
            description: `${item.name} service`,
          },
          unit_amount: item.price * 100, // Stripe expects amounts in cents
        },
        quantity: item.quantity,
      }));
      
      // For now, we'll use the manual order fallback since we don't have a Stripe backend
      showManualCheckoutInstructions();
    }
    
    // Show manual checkout instructions
    function showManualCheckoutInstructions() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      `;
      
      const orderDetails = window.stripeCart.items.map(item => 
        `${item.name} (Qty: ${item.quantity}) - $${(item.price * item.quantity).toLocaleString()}`
      ).join('\n');
      
      modal.innerHTML = `
        <div style="
          background: var(--dark-900);
          border: var(--card-border);
          border-radius: var(--radius-lg);
          max-width: 500px;
          width: 100%;
          padding: 40px;
          text-align: center;
        ">
          <h2 style="color: var(--text-primary); margin-bottom: 20px;">Complete Your Order</h2>
          <p style="color: var(--text-secondary); margin-bottom: 30px; line-height: 1.6;">
            Total: <strong style="color: var(--brand-gold);">$${window.stripeCart.total.toLocaleString()}</strong>
          </p>
          <div style="
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 30px;
            text-align: left;
          ">
            <h4 style="color: var(--text-primary); margin-bottom: 15px;">Order Summary:</h4>
            <pre style="color: var(--text-secondary); font-family: monospace; white-space: pre-wrap;">${orderDetails}</pre>
          </div>
          <p style="color: var(--text-secondary); margin-bottom: 30px; line-height: 1.6;">
            Please provide your contact information below and we'll process your order manually.
          </p>
          <div style="margin-bottom: 20px;">
            <input type="text" id="manualName" placeholder="Your Name" required style="
              width: 100%;
              padding: 12px;
              background: var(--dark-800);
              border: 1px solid var(--card-border);
              border-radius: var(--radius-md);
              color: var(--text-primary);
              margin-bottom: 10px;
            ">
            <input type="email" id="manualEmail" placeholder="Your Email" required style="
              width: 100%;
              padding: 12px;
              background: var(--dark-800);
              border: 1px solid var(--card-border);
              border-radius: var(--radius-md);
              color: var(--text-primary);
              margin-bottom: 10px;
            ">
            <input type="tel" id="manualPhone" placeholder="Your Phone (optional)" style="
              width: 100%;
              padding: 12px;
              background: var(--dark-800);
              border: 1px solid var(--card-border);
              border-radius: var(--radius-md);
              color: var(--text-primary);
            ">
          </div>
          <div style="display: flex; gap: 15px; justify-content: center;">
            <button onclick="this.closest('.modal-overlay').remove()" style="
              padding: 12px 24px;
              background: rgba(239, 68, 68, 0.1);
              color: var(--brand-red);
              border: 1px solid var(--brand-red);
              border-radius: var(--radius-md);
              cursor: pointer;
              font-weight: 600;
            ">
              Close
            </button>
            <button onclick="submitManualOrder()" style="
              padding: 12px 24px;
              background: var(--brand-gold);
              color: #000;
              border: none;
              border-radius: var(--radius-md);
              cursor: pointer;
              font-weight: 600;
            ">
              <i class="fas fa-paper-plane"></i>
              Submit Order
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Setup cart event listeners
    function setupCartEventListeners() {
      // Cart toggle button
      const cartToggle = document.getElementById('stripeCartToggle');
      const cart = document.getElementById('stripeCart');
      
      if (cartToggle && cart) {
        cartToggle.addEventListener('click', () => {
          cart.classList.toggle('show');
        });
      }
      
      // Cart close button
      const cartClose = document.getElementById('stripeCartClose');
      if (cartClose && cart) {
        cartClose.addEventListener('click', () => {
          cart.classList.remove('show');
        });
      }
      
      // Cart checkout button
      const cartCheckout = document.getElementById('stripeCartCheckout');
      if (cartCheckout) {
        cartCheckout.addEventListener('click', processStripeCheckout);
      }
      
      // Cart clear button
      const cartClear = document.getElementById('stripeCartClear');
      if (cartClear) {
        cartClear.addEventListener('click', clearStripeCart);
      }
      
      // Service detail modal close button
      const modalClose = document.getElementById('serviceDetailClose');
      const modal = document.getElementById('serviceDetailModal');
      
      if (modalClose && modal) {
        modalClose.addEventListener('click', () => {
          modal.classList.remove('show');
        });
      }
      
      // Close modal when clicking outside
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('show');
          }
        });
      }
      
      // Close cart when clicking outside
      if (cart) {
        cart.addEventListener('click', (e) => {
          if (e.target === cart) {
            cart.classList.remove('show');
          }
        });
      }
    }

    // Make functions globally available
    window.removeFromStripeCart = removeFromStripeCart;
    window.submitManualOrder = submitManualOrder;
    window.processStripeCheckout = processStripeCheckout;
    window.showManualCheckoutInstructions = showManualCheckoutInstructions;
    
    // Debug function to test cart
    function testCart() {
      console.log('Testing cart functionality...');
      console.log('Cart toggle element:', document.getElementById('stripeCartToggle'));
      console.log('Cart element:', document.getElementById('stripeCart'));
      console.log('Current cart items:', window.stripeCart.items);
      console.log('Cart toggle display:', document.getElementById('stripeCartToggle')?.style.display);
      
      // Test adding an item
      const testService = {
        id: 'test-service',
        name: 'Test Service',
        price: 100,
        icon: 'fas fa-cog'
      };
      
      addToStripeCart('test-service', testService);
      
      // Test opening cart
      const cart = document.getElementById('stripeCart');
      if (cart) {
        cart.classList.add('show');
        console.log('Cart should now be visible');
      }
    }
    
    // Make testCart globally available
    window.testCart = testCart;
    
    // ===============================
    // Airtable previews on Services
    // ===============================
    // Minimal renderer so airtable-cms can delegate to it
    window.portfolioSlideshow = window.portfolioSlideshow || {};
    window.portfolioSlideshow.populateGrid = function(gridId, items) {
      const grid = document.getElementById(gridId);
      if (!grid) return;
      const placeholder = 'data:image/svg+xml;base64,' + btoa(`<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="900"><rect width="100%" height="100%" fill="#0b1220"/></svg>`);
      // Skeletons while we render
      if (!Array.isArray(items) || items.length === 0) {
        grid.innerHTML = new Array(6).fill(0).map(() => `
          <div class="cf-skel">
            <div class="cf-skel-top"></div>
            <div class="cf-skel-body">
              <div class="cf-skel-line lg" style="width:70%"></div>
              <div class="cf-skel-line" style="width:45%"></div>
            </div>
          </div>
        `).join('');
        return;
      }
      const isPhotoGrid = gridId.toLowerCase().includes('photo');
      if (isPhotoGrid) {
        // Photography: image-only masonry tiles, preserve ratios
        grid.innerHTML = items.map((it) => {
          const img = (window.airtableCMS && window.airtableCMS.resolveThumbnailSrc ? window.airtableCMS.resolveThumbnailSrc(it) : (it['image_url'] || it['Thumbnail Image'] || it.thumbnailUrl || it.Image || it.image || it.thumbnail)) || placeholder;
          const alt = it.Title || 'Photo';
          return `
            <div class="masonry-item">
              <img src="${img}" alt="${alt}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=1200&fit=crop'" />
            </div>
          `;
        }).join('');
        Array.from(grid.querySelectorAll('.masonry-item img')).forEach((el) => {
          el.addEventListener('click', () => {
            if (window.airtableCMS && window.airtableCMS.openImageModal) {
              window.airtableCMS.openImageModal(el.src, el.alt || '');
            }
          });
        });
        return;
      }
      grid.innerHTML = items.map((it) => {
        const img = (window.airtableCMS && window.airtableCMS.resolveThumbnailSrc ? window.airtableCMS.resolveThumbnailSrc(it) : (it['Thumbnail Image'] || it.thumbnailUrl || it.Image || it.image || it.thumbnail)) || placeholder;
        const isVideo = !!it.playbackUrl || (it.ServiceCategory === 'Video Production');
        const isWeb = it.ServiceCategory === 'Web Development' && !!it.URL;
        const icon = isVideo ? 'play' : (isWeb ? 'external-link-alt' : 'eye');
        const title = it.Title || it.title || '';
        const sub = it.Description || it['Tech Stack'] || it.Client || '';
        const date = (it.UploadDate || '').split('T')[0] || '';
        const featured = it['Is Featured'] === true || it['Is Featured'] === 'true';
        const chip = (it.RealCategory && it.RealCategory !== 'Video Production') ? it.RealCategory : (it.ServiceCategory || it.Category || '');
        return `
          <div class="cf-card" data-service-category="${chip}" ${isVideo && it.playbackUrl ? `data-playback-url="${it.playbackUrl}"` : ''}>
            <div class="cf-thumb">
              <img src="${img}" alt="${title}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=1200&fit=crop'">
              ${chip ? `<span class="cf-chip">${chip}</span>` : ''}
              ${featured ? `<span class="cf-badge" title="Featured"><i class="fas fa-star"></i></span>` : ''}
              <div class="cf-action"><i class="fas fa-${icon}"></i></div>
            </div>
            <div class="cf-body">
              <h4 class="cf-title">${title}</h4>
              ${sub ? `<p class="cf-sub">${sub}</p>` : ''}
              <div class="cf-meta">
                ${it.Client ? `<span class="cf-pill"><i class=\"fas fa-user\"></i> ${it.Client}</span>` : `${it['Tech Stack'] ? `<span class=\"cf-pill\"><i class=\"fas fa-code\"></i> ${it['Tech Stack']}</span>` : '<span></span>'}`}
                ${date ? `<span class="cf-date">${date}</span>` : '<span></span>'}
              </div>
            </div>
          </div>
        `;
      }).join('');
      // Click handlers
      Array.from(grid.children).forEach((el, idx) => {
        const it = items[idx];
        el.addEventListener('click', () => {
          if ((it.playbackUrl || el.dataset.playbackUrl) && window.airtableCMS && window.airtableCMS.openVideoPopup) {
            const data = {
              title: it.Title || '',
              description: it.Description || '',
              videoUrl: it.playbackUrl || el.dataset.playbackUrl,
              playbackUrl: it.playbackUrl || el.dataset.playbackUrl,
              category: it.ServiceCategory || it.Category || 'Video Production',
              realCategory: it.RealCategory || '',
              role: it.Role || '',
              client: it.Client || '',
              timeline: it.Timeline || ''
            };
            window.airtableCMS.openVideoPopup(data);
          } else if (it.URL) {
            window.open(it.URL, '_blank');
          } else if (window.airtableCMS && window.airtableCMS.openImageModal) {
            const src = (it['Thumbnail Image'] || it.thumbnailUrl || it.Image || it.image || it.thumbnail || placeholder);
            window.airtableCMS.openImageModal(src, it.Title || '');
          }
        });
      });
    };
    
    function initializeServicesPortfolioGrids() {
      const tryInit = (attempt = 0) => {
        if (window.airtableCMS && typeof window.airtableCMS.loadPortfolioItems === 'function') {
          window.airtableCMS.loadPortfolioItems('Video Production', 'videoProductionGridServices', 6);
          window.airtableCMS.loadPortfolioItems('Web Development', 'webDevelopmentGridServices', 6);
          window.airtableCMS.loadPortfolioItems('Photography', 'photographyGridServices', 6);
          window.airtableCMS.loadPortfolioItems('Brand Development', 'brandDevelopmentGridServices', 6);
          return;
        }
        if (attempt < 15) {
          setTimeout(() => tryInit(attempt + 1), 200);
        }
      };
      tryInit();
    }
  </script>
</body>
</html>
